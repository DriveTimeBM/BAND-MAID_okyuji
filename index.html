<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BAND-MAID Okyuji Setlists</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  margin: 20px;
}
.okyuji {
  margin-bottom: 10px;
  padding: 10px;
  border: 1px solid #444;
  border-radius: 5px;
}
.okyuji-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  font-weight: bold;
  background: #222;
  padding: 10px;
  border-radius: 5px;
}
.okyuji-header:hover {
  background: #333;
}
.setlist {
  margin-top: 8px;
  margin-left: 20px;
  display: none;
}
.setlist li {
  list-style: none;
  padding: 2px 0;
}
.link {
  color: #66ccff;
  text-decoration: none;
}
.link:hover {
  text-decoration: underline;
}
</style>
</head>
<body>

<h1>BAND-MAID Okyuji Setlists</h1>
<div id="setlists"></div>

<script>
    fetch('setlists.json')
      .then(r => r.json())
      .then(data => {
        // Sort by Date DESC, then Sequence ASC
        data.sort((a, b) => {
          if (a.Date !== b.Date) return b.Date.localeCompare(a.Date);
          return a.Sequence - b.Sequence;
        });
    
        const container = document.getElementById('setlists');
        const grouped = new Map();
    
        // Preserve sorted order by inserting into Map
        data.forEach(item => {
          if (!grouped.has(item.SetId)) grouped.set(item.SetId, []);
          grouped.get(item.SetId).push(item);
        });
    
        // Render in insertion order (keeps date descending)
        for (const set of grouped.values()) {
          const first = set[0];
          const date = first.Date;
          const headerText = `${date} ${first.City} ${first.Country} ${first.Venue}`;
    
          const wrapper = document.createElement('div');
          wrapper.className = 'okyuji';
    
          const header = document.createElement('div');
          header.className = 'okyuji-header';
          header.textContent = headerText;
    
          const link = document.createElement('a');
          link.href = first.URL;
          link.textContent = 'Setlist.fm';
          link.className = 'link';
          link.target = '_blank';
          link.onclick = e => e.stopPropagation();
    
          header.appendChild(link);
    
          const list = document.createElement('ul');
          list.className = 'setlist';
          set.forEach(song => {
            const li = document.createElement('li');
            li.textContent = `${song.Sequence}. ${song.Song}`;
            list.appendChild(li);
          });
    
          header.addEventListener('click', () => {
            list.style.display = list.style.display === 'block' ? 'none' : 'block';
          });
    
          wrapper.appendChild(header);
          wrapper.appendChild(list);
          container.appendChild(wrapper);
        }
      })
      .catch(err => {
        console.error('Error loading setlists:', err);
        document.getElementById('setlists').textContent = 'Failed to load setlists.';
      });
    </script>    
    

</body>
</html>
